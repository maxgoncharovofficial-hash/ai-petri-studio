name: Deploy to GitHub Pages (Simple)

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Show directory structure
        run: |
          echo "üìÅ Current directory structure:"
          ls -la
          echo "üìÅ Assets:"
          ls -la assets/ || echo "No assets directory"
          echo "üìÅ Pages:"
          ls -la pages/ || echo "No pages directory"
          
      - name: Create simple deployment
        run: |
          echo "üöÄ Creating simple deployment structure..."
          
          # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É
          mkdir -p deploy
          
          # –ö–æ–ø–∏—Ä—É–µ–º –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã
          echo "Copying index.html..."
          cp index.html deploy/
          
          echo "Copying assets..."
          cp -r assets deploy/
          
          echo "Copying pages..."
          if [ -d "pages" ]; then
            for file in pages/*.html; do
              if [ -f "$file" ]; then
                cp "$file" deploy/
                echo "Copied: $(basename "$file")"
              fi
            done
          fi
          
          echo "‚úÖ Files copied to deploy directory"
          ls -la deploy/
          
      - name: Update paths
        run: |
          echo "üîß Updating file paths..."
          
          # –û–±–Ω–æ–≤–ª—è–µ–º –ø—É—Ç–∏ –≤ HTML —Ñ–∞–π–ª–∞—Ö
          if ls deploy/*.html 1> /dev/null 2>&1; then
            for file in deploy/*.html; do
              if [ -f "$file" ]; then
                echo "Processing: $(basename "$file")"
                # –ó–∞–º–µ–Ω—è–µ–º ../assets/ –Ω–∞ assets/
                sed -i 's|../assets/|assets/|g' "$file" || echo "Warning: failed to update assets path in $file"
                # –£–±–∏—Ä–∞–µ–º pages/ –∏–∑ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                sed -i 's|pages/||g' "$file" || echo "Warning: failed to update pages path in $file"
                sed -i 's|../index.html|index.html|g' "$file" || echo "Warning: failed to update index path in $file"
              fi
            done
          else
            echo "No HTML files found in deploy directory"
          fi
          
          # –û–±–Ω–æ–≤–ª—è–µ–º JS —Ñ–∞–π–ª—ã
          if [ -d "deploy/assets/js" ]; then
            for file in deploy/assets/js/*.js; do
              if [ -f "$file" ]; then
                echo "Processing JS: $(basename "$file")"
                sed -i 's|pages/||g' "$file" || echo "Warning: failed to update pages path in $file"
                sed -i 's|../index.html|index.html|g' "$file" || echo "Warning: failed to update index path in $file"
              fi
            done
          else
            echo "No JS directory found"
          fi
          
          echo "‚úÖ Paths updated successfully"
          
      - name: Setup Pages
        uses: actions/configure-pages@v4
        
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./deploy
          
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
        
      - name: Cleanup
        run: |
          rm -rf deploy
          echo "‚úÖ Cleanup completed"
          
      - name: Success
        run: |
          echo "üéâ Deployment successful!"
          echo "URL: ${{ steps.deployment.outputs.page_url }}" 