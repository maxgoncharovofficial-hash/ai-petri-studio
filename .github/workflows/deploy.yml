name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          
      - name: Create deployment structure
        run: |
          echo "Creating deployment structure for GitHub Pages..."
          
          # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É –¥–ª—è —Å–±–æ—Ä–∫–∏
          mkdir -p temp-deploy
          
          # –ö–æ–ø–∏—Ä—É–µ–º index.html –≤ –∫–æ—Ä–µ–Ω—å
          cp index.html temp-deploy/
          
          # –ö–æ–ø–∏—Ä—É–µ–º –ø–∞–ø–∫—É assets
          cp -r assets temp-deploy/
          
          # –ö–æ–ø–∏—Ä—É–µ–º HTML —Ñ–∞–π–ª—ã –∏–∑ pages/ –≤ –∫–æ—Ä–µ–Ω—å
          cp pages/*.html temp-deploy/
          
          # –û–±–Ω–æ–≤–ª—è–µ–º –ø—É—Ç–∏ –≤ HTML —Ñ–∞–π–ª–∞—Ö –¥–ª—è GitHub Pages
          echo "Updating paths in HTML files..."
          
          # –û–±–Ω–æ–≤–ª—è–µ–º –ø—É—Ç–∏ –≤ index.html
          sed -i 's|assets/|assets/|g' temp-deploy/index.html
          
          # –û–±–Ω–æ–≤–ª—è–µ–º –ø—É—Ç–∏ –≤ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö HTML —Ñ–∞–π–ª–∞—Ö
          for file in temp-deploy/*.html; do
            if [ "$(basename "$file")" != "index.html" ]; then
              # –ó–∞–º–µ–Ω—è–µ–º ../assets/ –Ω–∞ assets/ –¥–ª—è —Ñ–∞–π–ª–æ–≤ –∏–∑ pages/
              sed -i 's|../assets/|assets/|g' "$file"
              # –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
              sed -i 's|pages/||g' "$file"
            fi
          done
          
          # –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –≤ JS —Ñ–∞–π–ª–∞—Ö
          echo "Updating navigation in JS files..."
          for file in temp-deploy/assets/js/*.js; do
            # –ó–∞–º–µ–Ω—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –Ω–∞ pages/ –Ω–∞ –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏
            sed -i 's|pages/||g' "$file"
            # –ó–∞–º–µ–Ω—è–µ–º ../index.html –Ω–∞ index.html
            sed -i 's|../index.html|index.html|g' "$file"
          done
          
          echo "Deployment structure created successfully!"
          
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./temp-deploy
          force_orphan: true
          
      - name: Cleanup
        run: |
          echo "Cleaning up temporary files..."
          rm -rf temp-deploy
          
      - name: Success message
        run: |
          echo "‚úÖ Deployment completed successfully!"
          echo "üåê Your Telegram Mini App is now available at:"
          echo "https://${{ github.repository_owner }}.github.io/$(echo ${{ github.repository }} | cut -d'/' -f2)/" 